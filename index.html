<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizTime Premium - Українська Вікторина</title>
    <!-- Подключаем Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a1428, #1a2744, #0f1b2e);
            color: #00ffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-top: 80px;
        }
        
        .neon-box {
            background: rgba(0, 255, 255, 0.05);
            border: 2px solid #00ffff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3), inset 0 0 20px rgba(0, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 600px;
        }
        
        .neon-box::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, #00ffff, #00ff88, #00ffff);
            border-radius: 20px;
            z-index: -1;
            opacity: 0.1;
        }
        
        .logo {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #00ffff;
            background: linear-gradient(45deg, #00ffff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #00cccc;
        }
        
        .slogan {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 30px;
            text-shadow: 0 0 15px #00ff88;
        }
        
        .btn {
            background: linear-gradient(45deg, #00ffff, #00ff88);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            color: #001122;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 30px rgba(0, 255, 255, 0.7);
        }
        
        .btn-secondary {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            color: #00ffff;
        }
        
        .btn-level {
            display: block;
            width: 100%;
            margin: 15px 0;
            padding: 20px;
            font-size: 1.2rem;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
            margin: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #00cccc;
        }
        
        .question-container {
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .question {
            font-size: 1.4rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #00ffff;
        }
        
        .timer.warning {
            color: #ff4444;
            text-shadow: 0 0 15px #ff4444;
        }
        
        .answers {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .answer-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            padding: 15px;
            border-radius: 15px;
            color: #00ffff;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .answer-btn:hover:not(:disabled) {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        
        .answer-btn.correct {
            background: rgba(0, 255, 136, 0.3);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
        }
        
        .answer-btn.wrong {
            background: rgba(255, 68, 68, 0.3);
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.6);
        }
        
        .leaderboard {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .leader-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 10px;
        }
        
        .leader-rank {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
            width: 50px;
        }
        
        .prizes {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .prize {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            color: #001122;
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        
        .screen {
            display: none;
            width: 100%;
        }
        
        .screen.active {
            display: block;
        }
        
        .score-display {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(0, 20, 40, 0.95);
            border: 2px solid #00ffff;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
            backdrop-filter: blur(10px);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 255, 255, 0.2);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #00ff88);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
        }
        
        @media (max-width: 600px) {
            .logo { font-size: 2.5rem; }
            .slogan { font-size: 1.4rem; }
            .container { padding: 15px; padding-top: 70px; }
            .neon-box { padding: 20px; }
            .score-display { 
                font-size: 0.8rem; 
                padding: 6px 12px;
                top: 10px;
                right: 10px;
            }
        }
    
        /* Анимация монет/очков */
        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-animate {
            animation: pop 0.5s ease;
        }

        /* Анимация экрана результата */
        #resultScreen .neon-box {
            animation: resultFade 1s ease;
        }
        @keyframes resultFade {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Стили для попапа подписки */
        #subscribePopup {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            color: #fff;
            text-align: center;
            padding-top: 15vh;
        }

        #stripePaymentForm {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0,20,40,0.9);
            border: 2px solid #00ffff;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,255,255,0.3);
        }

        .StripeElement {
            background: rgba(0,255,255,0.1);
            padding: 15px;
            border: 1px solid #00ffff;
            border-radius: 10px;
            margin: 15px 0;
            color: white;
        }

        .subscription-features {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,255,255,0.1);
            border-radius: 10px;
            text-align: left;
        }

        .subscription-features li {
            margin: 10px 0;
            list-style-type: none;
            position: relative;
            padding-left: 25px;
        }

        .subscription-features li:before {
            content: "✓";
            color: #00ff88;
            position: absolute;
            left: 0;
        }
    </style>
</head>
<body>
    <!-- Попап подписки -->
    <div id="subscribePopup">
        <form id="stripePaymentForm">
            <h2 style="color:#00ff88">🔒 PREMIUM ПОДПИСКА</h2>
            <p>Доступ за $2.99/месяц откроет:</p>
            
            <div class="subscription-features">
                <ul>
                    <li>Полную версию викторины</li>
                    <li>Участие в рейтинге за $100-$1000</li>
                    <li>Отсутствие рекламы</li>
                    <li>Отмена в любой момент</li>
                </ul>
            </div>
            
            <div id="cardElement" class="StripeElement"></div>
            
            <button id="submitBtn" class="btn" type="submit">
                ОПЛАТИТЬ $2.99/МЕС
            </button>
            
            <button class="btn btn-secondary" onclick="hideSubscribePopup()" style="margin-top: 10px;">
                Продолжить бесплатно (с ограничениями)
            </button>
            
            <p style="font-size:12px; margin-top:20px;">
                Нажимая кнопку, вы соглашаетесь с <a href="#" style="color:#00ffff">условиями</a>.
            </p>
        </form>
    </div>

    <div class="score-display" id="scoreDisplay">
        💰 <span id="coinsDisplay">0</span> | ⭐ <span id="pointsDisplay">0</span>
    </div>

    <div class="container">
        <!-- Головний екран -->
        <div class="screen active" id="homeScreen">
            <div class="neon-box">
                <h1 class="logo">QuizTime</h1>
                <p class="subtitle">Українська Вікторина</p>
                <p class="slogan">ГРАЙ ТА ЗАРОБЛЯЙ</p>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">Ігор зіграно</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalCoins">0</div>
                        <div class="stat-label">Монет зароблено</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bestScore">0</div>
                        <div class="stat-label">Кращий результат</div>
                    </div>
                </div>
                
                <button class="btn" onclick="showLevelSelect()">ПОЧАТИ ГРУ</button>
                <button class="btn btn-secondary" onclick="showLeaderboard()">РЕЙТИНГ</button>
                <button class="btn btn-secondary" onclick="showInfo()">ІНФО ПРО ПРИЗИ</button>
            </div>
        </div>

        <!-- Вибір рівня складності -->
        <div class="screen" id="levelScreen">
            <div class="neon-box">
                <h2 style="margin-bottom: 30px;">🎯 ОБЕРІТЬ РІВЕНЬ СКЛАДНОСТІ</h2>
                
                <button class="btn btn-level" onclick="startGame('easy')">
                    🟢 ЛЕГКИЙ<br>
                    <small style="opacity: 0.8;">Загальні знання, +10 монет</small>
                </button>
                
                <button class="btn btn-level" onclick="startGame('medium')">
                    🟡 СЕРЕДНІЙ<br>
                    <small style="opacity: 0.8;">Науки та культура, +15 монет</small>
                </button>
                
                <button class="btn btn-level" onclick="startGame('hard')">
                    🔴 СКЛАДНИЙ<br>
                    <small style="opacity: 0.8;">Професійні знання, +25 монет</small>
                </button>
                
                <button class="btn btn-secondary" onclick="showHome()" style="margin-top: 20px;">НАЗАД</button>
            </div>
        </div>

        <!-- Екран гри -->
        <div class="screen" id="gameScreen">
            <div class="neon-box">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="question-container">
                    <div class="timer" id="timer">30</div>
                    <div class="question" id="question"></div>
                    <div class="answers" id="answers"></div>
                </div>
                <button class="btn btn-secondary" onclick="endGame()" style="margin-top: 20px;">ЗАВЕРШИТИ ГРУ</button>
            </div>
        </div>

        <!-- Рейтинг -->
        <div class="screen" id="leaderboardScreen">
            <div class="neon-box">
                <h2 style="margin-bottom: 20px;">🏆 РЕЙТИНГ ГРАВЦІВ</h2>
                <div class="leaderboard" id="leaderboard"></div>
                <button class="btn" onclick="showHome()">ПОВЕРНУТИСЯ</button>
            </div>
        </div>

        <!-- Інфо про призи -->
        <div class="screen" id="infoScreen">
            <div class="neon-box">
                <h2 style="margin-bottom: 20px;">💰 ІНФОРМАЦІЯ ПРО ПРИЗИ</h2>
                <p style="margin-bottom: 20px; line-height: 1.6;">
                    Відповідай на питання та піднімайся в ТОП! Щомісяця ТОП 3 гравці виграють реальні гроші!
                </p>
                
                <div class="prizes">
                    <div class="prize">1️⃣ $500</div>
                    <div class="prize">2️⃣ $250</div>
                    <div class="prize">3️⃣ $100</div>
                </div>
                
                <div style="margin-top: 30px; text-align: left; line-height: 1.8;">
                    <h3 style="color: #00ff88; margin-bottom: 15px;">📋 ПРАВИЛА ГРИ:</h3>
                    <p>• На кожне питання дається 30 секунд</p>
                    <p>• Швидка відповідь = більше очок</p>
                    <p>• Легкий рівень: +10 монет за відповідь</p>
                    <p>• Середній рівень: +15 монет за відповідь</p>
                    <p>• Складний рівень: +25 монет за відповідь</p>
                    <p>• Бонус за швидкість: до +15 очок</p>
                    <p>• Призи нараховуються щомісяця</p>
                </div>
                
                <button class="btn" onclick="showHome()">ПОВЕРНУТИСЯ</button>
            </div>
        </div>

        <!-- Результат гри -->
        <div class="screen" id="resultScreen">
            <div class="neon-box">
                <h2 style="margin-bottom: 20px;">🎉 РЕЗУЛЬТАТ ГРИ</h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="finalScore">0</div>
                        <div class="stat-label">Очки за гру</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="finalCoins">0</div>
                        <div class="stat-label">Монети зароблено</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="correctAnswers">0</div>
                        <div class="stat-label">Правильних відповідей</div>
                    </div>
                </div>
                <button class="btn" onclick="showLevelSelect()">ГРАТИ ЗНОВУ</button>
                <button class="btn btn-secondary" onclick="showHome()">ГОЛОВНЕ МЕНЮ</button>
            </div>
        </div>
    </div>

    <audio id="sound-correct" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_1039b14249.mp3?filename=success-1-6297.mp3"></audio>
    <audio id="sound-wrong" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_36528782f7.mp3?filename=wrong-answer-129254.mp3"></audio>
    <audio id="sound-timer" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_ea5cb39c75.mp3?filename=countdown-129234.mp3"></audio>
    
    <div style="position: fixed; bottom: 15px; right: 15px; z-index: 1001;">
        <button class="btn btn-secondary" onclick="toggleMusic()" style="padding: 6px 12px; font-size: 0.8rem;">🎵 Музыка Вкл/Выкл</button>
    </div>

    <audio id="background-music" src="https://cdn.pixabay.com/download/audio/2023/04/23/audio_4d9941c135.mp3?filename=8-bit-game-music-145981.mp3" loop></audio>

    <script>
        // Конфигурация Stripe (ЗАМЕНИТЕ НА ВАШ КЛЮЧ)
        const stripe = Stripe('pk_test_ваш_публичный_ключ');
        let cardElement;
        
        // Банк питань по рівнях складності
        const questionBank = {
            easy: [
                {
                    question: "Скільки континентів на Землі?",
                    answers: ["6", "7", "8", "5"],
                    correct: 1
                },
                // ... остальные вопросы из вашего оригинала
            ],
            medium: [
                // ... вопросы средней сложности
            ],
            hard: [
                // ... сложные вопросы
            ]
        };

        // Игровой состояние
        let gameState = {
            currentQuestion: 0,
            score: 0,
            coins: 0,
            timeLeft: 30,
            timer: null,
            gameCoins: 0,
            gameScore: 0,
            correctCount: 0,
            totalGames: 0,
            bestScore: 0,
            currentLevel: 'easy',
            questions: []
        };

        let gameEnded = false;
        let freeAnswersUsed = 0;
        const MAX_FREE_ANSWERS = 2;

        // Инициализация Stripe Elements
        function initStripe() {
            const elements = stripe.elements();
            cardElement = elements.create('card', {
                style: {
                    base: {
                        color: '#ffffff',
                        fontFamily: '"Arial", sans-serif',
                        fontSize: '16px',
                        '::placeholder': { color: '#aab7c4' }
                    }
                }
            });
            cardElement.mount('#cardElement');
        }

        // Проверка подписки
        function checkSubscription() {
            const isSubscribed = localStorage.getItem('quizTimeSubscribed') === 'true';
            
            if(!isSubscribed) {
                freeAnswersUsed++;
                if(freeAnswersUsed > MAX_FREE_ANSWERS) {
                    showSubscribePopup();
                    return false;
                }
            }
            return true;
        }

        function showSubscribePopup() {
            document.getElementById('subscribePopup').style.display = 'block';
        }

        function hideSubscribePopup() {
            document.getElementById('subscribePopup').style.display = 'none';
        }

        // Обработка подписки
        async function processSubscription() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Обработка...';
            
            try {
                // Создаем платежный метод
                const { paymentMethod, error } = await stripe.createPaymentMethod({
                    type: 'card',
                    card: cardElement
                });
                
                if (error) throw error;
                
                // В реальном проекте здесь должен быть вызов вашего бекенда
                // Для демо-версии просто сохраняем флаг подписки
                localStorage.setItem('quizTimeSubscribed', 'true');
                hideSubscribePopup();
                alert('Подписка активирована! Теперь вы можете участвовать в рейтинге.');
                location.reload();
                
            } catch (error) {
                alert('Ошибка: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'ОПЛАТИТЬ $2.99/МЕС';
            }
        }

        // Остальные функции игры (из вашего оригинала)
        function animatePop(elementId) {
            const el = document.getElementById(elementId);
            el.classList.add('pop-animate');
            setTimeout(() => {
                el.classList.remove('pop-animate');
            }, 500);
        }

        function updateDisplay() {
            document.getElementById('coinsDisplay').textContent = gameState.coins;
            document.getElementById('pointsDisplay').textContent = gameState.score;
        }

        function updateStats() {
            document.getElementById('totalGames').textContent = gameState.totalGames;
            document.getElementById('totalCoins').textContent = gameState.coins;
            document.getElementById('bestScore').textContent = gameState.bestScore;
        }

        function saveProgress() {
            const dataToSave = {
                score: gameState.score,
                coins: gameState.coins,
                totalGames: gameState.totalGames,
                bestScore: gameState.bestScore
            };
            localStorage.setItem('quizTimeData', JSON.stringify(dataToSave));
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showHome() {
            showScreen('homeScreen');
            updateStats();
        }

        function showLevelSelect() {
            showScreen('levelScreen');
        }

        function showLeaderboard() {
            showScreen('leaderboardScreen');
            generateLeaderboard();
        }

        function showInfo() {
            showScreen('infoScreen');
        }

        function generateLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const leaders = [
                { name: "Олександр", score: 2850, coins: 485 },
                { name: "Марія", score: 2720, coins: 465 },
                { name: "Дмитро", score: 2650, coins: 445 },
                { name: "Анна", score: 2580, coins: 425 },
                { name: "Сергій", score: 2490, coins: 395 },
                { name: "Ви", score: gameState.bestScore, coins: gameState.coins }
            ];
            
            leaders.sort((a, b) => b.score - a.score);
            
            leaderboard.innerHTML = leaders.map((leader, index) => `
                <div class="leader-item" style="${leader.name === 'Ви' ? 'border-color: #00ff88;' : ''}">
                    <span class="leader-rank">${index + 1}</span>
                    <span>${leader.name}</span>
                    <span>${leader.score} очок</span>
                </div>
            `).join('');
        }

        function startGame(level) {
            if (!checkSubscription()) return;
            
            gameEnded = false;
            gameState.currentLevel = level;
            gameState.currentQuestion = 0;
            gameState.gameCoins = 0;
            gameState.gameScore = 0;
            gameState.correctCount = 0;
            
            gameState.questions = [...questionBank[level]];
            gameState.questions.sort(() => Math.random() - 0.5);

            document.getElementById('progressFill').style.width = '0%';
            
            showScreen('gameScreen');
            nextQuestion();
        }

        function nextQuestion() {
            if (gameState.currentQuestion >= gameState.questions.length) {
                endGame();
                return;
            }

            updateProgress();
            
            const question = gameState.questions[gameState.currentQuestion];
            document.getElementById('question').textContent = question.question;
            
            const shuffledAnswers = question.answers.map((answer, index) => ({ answer, index }))
                                                    .sort(() => Math.random() - 0.5);
            
            gameState.shuffledCorrectIndex = shuffledAnswers.findIndex(item => item.index === question.correct);
            
            const answersContainer = document.getElementById('answers');
            answersContainer.innerHTML = shuffledAnswers.map((item, displayIndex) => `
                <button class="answer-btn" onclick="selectAnswer(${displayIndex})">${item.answer}</button>
            `).join('');

            startTimer();
        }

        function updateProgress() {
            const progress = ((gameState.currentQuestion + 1) / gameState.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function startTimer() {
            gameState.timeLeft = 30;
            updateTimer();
            
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateTimer();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    selectAnswer(-1);
                }
            }, 1000);
        }

        function updateTimer() {
            const timerElement = document.getElementById('timer');
            timerElement.textContent = gameState.timeLeft;
            
            if (gameState.timeLeft <= 10) {
                timerElement.classList.add('warning');
                playSound('sound-timer');
            } else {
                timerElement.classList.remove('warning');
            }
        }

        function selectAnswer(selectedIndex) {
            if (!checkSubscription()) return;
            
            clearInterval(gameState.timer);
            
            const question = gameState.questions[gameState.currentQuestion];
            const answerButtons = document.querySelectorAll('.answer-btn');
            
            const isCorrect = selectedIndex === gameState.shuffledCorrectIndex;
            
            if (selectedIndex === -1) {
                answerButtons.forEach((btn, index) => {
                    if (index === gameState.shuffledCorrectIndex) {
                        btn.classList.add('correct');
                    }
                    btn.disabled = true;
                });
            } else {
                answerButtons.forEach((btn, index) => {
                    if (index === gameState.shuffledCorrectIndex) {
                        btn.classList.add('correct');
                    } else if (index === selectedIndex && !isCorrect) {
                        btn.classList.add('wrong');
                        playSound('sound-wrong');
                    }
                    btn.disabled = true;
                });
                
                if (isCorrect) {
                    gameState.correctCount++;
                    playSound('sound-correct');
                    animatePop('coinsDisplay');
                    animatePop('pointsDisplay');
                    
                    const coinReward = {
                        easy: 10,
                        medium: 15,
                        hard: 25
                    };
                    
                    gameState.gameCoins += coinReward[gameState.currentLevel];
                    
                    const speedBonus = Math.floor(gameState.timeLeft / 2);
                    gameState.gameScore += 10 + speedBonus;
                }
            }
            
            setTimeout(() => {
                gameState.currentQuestion++;
                nextQuestion();
            }, 2000);
        }

        function endGame() {
            if (gameEnded) return;
            gameEnded = true;
            
            clearInterval(gameState.timer);
            
            gameState.coins += gameState.gameCoins;
            gameState.score += gameState.gameScore;
            gameState.totalGames++;
            
            if (gameState.gameScore > gameState.bestScore) {
                gameState.bestScore = gameState.gameScore;
            }

            document.getElementById('finalScore').textContent = gameState.gameScore;
            document.getElementById('finalCoins').textContent = gameState.gameCoins;
            document.getElementById('correctAnswers').textContent = gameState.correctCount;

            saveProgress();
            updateDisplay();
            showScreen('resultScreen');
        }

        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) {
                sound.currentTime = 0;
                sound.play();
            }
        }

        function toggleMusic() {
            const music = document.getElementById('background-music');
            if (music.paused) {
                music.volume = 0.3;
                music.play();
            } else {
                music.pause();
            }
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateDisplay();
            updateStats();
            initStripe();
            
            document.getElementById('stripePaymentForm').addEventListener('submit', (e) => {
                e.preventDefault();
                processSubscription();
            });

            const music = document.getElementById('background-music');
            music.volume = 0.3;
            music.play();
        });

        function loadData() {
            const saved = localStorage.getItem('quizTimeData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    gameState.score = data.score || 0;
                    gameState.coins = data.coins || 0;
                    gameState.totalGames = data.totalGames || 0;
                    gameState.bestScore = data.bestScore || 0;
                } catch (e) {
                    console.error("Ошибка при чтении localStorage", e);
                    localStorage.removeItem('quizTimeData');
                }
            }
        }

        // Автосохранение каждые 30 секунд
        setInterval(saveProgress, 30000);
    </script>
</body>
</html>